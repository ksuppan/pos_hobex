<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record id="pos_payment_method_view_form_inherit_hobex" model="ir.ui.view">
    <field name="name">pos.payment.method.view.form.inherit.hobex</field>
    <field name="model">pos.payment.method</field>
    <field name="inherit_id" ref="point_of_sale.pos_payment_method_view_form"/>
    <field name="arch" type="xml">

      <!-- Insert right after the terminal selector; do NOT rely on <notebook> existing -->
      <xpath expr="//field[@name='use_payment_terminal']" position="after">

        <!-- HOBEX header separator -->
        <separator string="HOBEX" invisible="use_payment_terminal != 'hobex'"/>

        <!-- Logo (constrained size so it doesn't blow up the layout) -->
        <div invisible="use_payment_terminal != 'hobex'">
          <img src="/pos_hobex/static/src/img/hobex_logo_3.png"
               alt="hobex Logo"
               style="max-height:90px; width:auto; display:block; margin-bottom:12px;"/>
        </div>

        <!-- Button box: Odoo-supported container for form buttons -->
        <div name="button_box" invisible="use_payment_terminal != 'hobex'">
          <button name="hobex_get_auth_token"
                  type="object"
                  string="Check Connection"
                  icon="fa-handshake-o"
                  class="oe_stat_button"
                  invisible="hobex_auth_token != False"/>

          <button name="hobex_renew_auth_token"
                  type="object"
                  string="Renew Auth"
                  icon="fa-handshake-o"
                  class="oe_stat_button"
                  invisible="hobex_auth_token == False"/>

          <button name="hobex_sample_transaction"
                  type="object"
                  string="Sample Transaction"
                  icon="fa-credit-card"
                  class="oe_stat_button"
                  invisible="hobex_auth_token == False"/>
        </div>

        <!-- Warning about active sessions -->
        <div class="alert alert-warning"
             role="alert"
             invisible="use_payment_terminal != 'hobex' or active_pos_session_ids == False">
          <i class="fa fa-exclamation-circle" aria-hidden="true"></i>
          <span> Attention, there are active pos sessions based on this payment journal !</span>
        </div>

	<!-- Force a new line so the warning isn't fighting for the same row -->
<newline/>

<!-- Authentication / configuration: use a simple 2-col layout so widgets don't disappear -->
<group string="HOBEX Authentication" invisible="use_payment_terminal != 'hobex'" col="2">
  <!-- Keep these in the view (even if invisible) so expressions work -->
  <field name="hobex_connected" readonly="1" invisible="1"/>
  <field name="active_pos_session_ids" invisible="1"/>
  <field name="hobex_auth_token" invisible="1" readonly="1" force_save="1"/>

  <field name="hobex_terminal_mode" required="use_payment_terminal == 'hobex'"/>

  <!-- Admin-only field; in col=2 it will behave nicely without spanning tricks -->
  <field name="hobex_api_address" groups="base.group_no_one"/>

  <field name="hobex_terminal_id" required="use_payment_terminal == 'hobex'"/>
  <field name="hobex_user" required="use_payment_terminal == 'hobex'"/>
  <field name="hobex_pass" password="True" required="use_payment_terminal == 'hobex'"/>
</group>

<!-- New line + full width transactions -->
<newline/>

<group string="Transactions" invisible="use_payment_terminal != 'hobex'">
  <field name="hobex_transaction_ids" nolabel="1" readonly="1">
    <list create="0" edit="0" delete="0">
      <field name="state"/>
      <field name="transaction_date"/>
      <field name="reference"/>
      <field name="response_code"/>
      <field name="response_text"/>
      <field name="amount"/>
      <field name="currency"/>

      <button name="update_hobex_state"
              type="object"
              string="Hobex Status"
              icon="fa-credit-card"/>

      <button name="reversal_hobex_transaction"
              type="object"
              string="Hobex RÃ¼ckbuchen"
              icon="fa-credit-card"/>
    </list>
  </field>
</group>

      </xpath>

    </field>
  </record>

</odoo>
